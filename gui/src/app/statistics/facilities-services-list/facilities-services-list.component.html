<div class="container-fluid pt-5">
  <div class="card shadow-sm">
    <div class="card-body p-3 p-lg-5">
      <h4 class="card-title">
        {{ 'MENU.STATISTICS' | translate }}
      </h4>

      <div class="row overview-row">
        <div class="col-md-6">
          <div *ngIf="isLoadingTable"
               style="display: flex; justify-content: center; align-items: center; background: white;">
            <mat-progress-spinner color="primary" mode="indeterminate"></mat-progress-spinner>
          </div>
          <table *ngIf="!isLoadingTable" class="table table-stats overview-table">
            <tr>
              <th></th>
              <th *ngIf="hasProductionEnabled()">{{ 'SERVICES.PRODUCTION_SERVICES' | translate }}</th>
              <th *ngIf="hasStagingEnabled()">{{ 'SERVICES.STAGING_SERVICES' | translate }}</th>
              <th *ngIf="hasTestingEnabled()">{{ 'SERVICES.TESTING_SERVICES' | translate }}</th>
            </tr>
            <tr>
              <th>{{ 'SERVICES.ALL' | translate }}</th>
              <th *ngIf="hasProductionEnabled()">{{ getProductionCount() }}</th>
              <th *ngIf="hasStagingEnabled()">{{ getStagingCount() }}</th>
              <th *ngIf="hasTestingEnabled()">{{ getTestingCount() }}</th>
            </tr>
            <tr *ngIf="hasSamlEnabled()">
              <th>{{ 'SERVICES.SAML' | translate }}</th>
              <th *ngIf="hasProductionEnabled()">{{ getSamlProductionCount() }}</th>
              <th *ngIf="hasStagingEnabled()">{{ getSamlStagingCount() }}</th>
              <th *ngIf="hasTestingEnabled()">{{ getSamlTestingCount() }}</th>
            </tr>
            <tr *ngIf="hasOidcEnabled()">
              <th>{{ 'SERVICES.OIDC' | translate }}</th>
              <th *ngIf="hasProductionEnabled()">{{ getOidcProductionCount() }}</th>
              <th *ngIf="hasStagingEnabled()">{{ getOidcStagingCount() }}</th>
              <th *ngIf="hasTestingEnabled()">{{ getOidcTestingCount() }}</th>
            </tr>
          </table>
        </div>
        <div class="col-md-5 offset-1">
          <div *ngIf="isLoadingTable"
               style="display: flex; justify-content: center; align-items: center; background: white;">
            <mat-progress-spinner color="primary" mode="indeterminate"></mat-progress-spinner>
          </div>

          <ngx-charts-bar-vertical *ngIf="!isLoadingTable"
            [view]=""
            [results]="overviewTableData"
            [customColors]="colorScheme"
            [xAxis]="true"
            [yAxis]="true"
            [yAxisTickFormatting]="axisFormat"
            [gradient]="true">
          </ngx-charts-bar-vertical>

        </div>
      </div>

      <div *ngIf="!isLoadingTable" class="row">
        <ng-container
          *ngIf="!isApplicationAdmin(); then user; else admin">
        </ng-container>
        <ng-template #user>
          <div *ngIf="hasProductionEnabled() && hasDisplayableProductionServices()" class="services-table-wrapper mb-5">
            <h5>{{ 'SERVICES.PRODUCTION_SERVICES_LIST' | translate }}</h5>
            <mat-form-field class="w-100">
              <mat-icon matPrefix class="mr-1">search</mat-icon>
              <input matInput type="text" (keyup)="doFilterProduction($event.target.value)" placeholder="{{ 'SEARCH' | translate }}">
            </mat-form-field>
            <table *ngIf="!isLoadingTable" mat-table  matSort #sortProduction matSortActive="name" matSortDirection="asc"
                   matSortDisableClear [dataSource]="productionServicesDataSource" class="w-100">
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef class="w-20" mat-sort-header="name">{{ 'FACILITIES.NAME' | translate }}</th>
                <td mat-cell *matCellDef="let providedService">{{ providedService.name | itemLocale }}</td>
              </ng-container>
              <ng-container matColumnDef="description">
                <th mat-header-cell *matHeaderCellDef class="w-25" mat-sort-header="description">{{ 'FACILITIES.DESCRIPTION' | translate }}</th>
                <td mat-cell *matCellDef="let providedService">{{ providedService.description | itemLocale }}</td>
              </ng-container>
              <ng-container matColumnDef="environment">
                <th mat-header-cell *matHeaderCellDef class="w-10" mat-sort-header="environment">{{ 'FACILITIES.ENVIRONMENT' | translate }}</th>
                <td mat-cell *matCellDef="let providedService">{{ providedService.environment | facilityEnvironment }}</td>
              </ng-container>
              <ng-container matColumnDef="protocol">
                <th mat-header-cell *matHeaderCellDef class="w-10" mat-sort-header="protocol">{{ 'FACILITIES.PROTOCOL' | translate }}</th>
                <td mat-cell *matCellDef="let providedService">{{ providedService.protocol }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover-dark clickable"></tr>
            </table>
            <mat-paginator #paginatorProduction [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
          </div>
        </ng-template>

        <ng-template #admin>
          <!-- PROD ENV -->
          <div *ngIf="hasProductionEnabled() && hasDisplayableProductionServices()" class="services-table-wrapper mb-5">
            <mat-expansion-panel class="mb-2" [expanded]="true">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h5>{{ 'SERVICES.PRODUCTION_SERVICES_LIST' | translate }}</h5>
                </mat-panel-title>
              </mat-expansion-panel-header>
              <mat-form-field class="w-100">
                <mat-icon matPrefix class="mr-1">search</mat-icon>
                <input matInput type="text" (keyup)="doFilterProduction($event.target.value)" placeholder="{{ 'SEARCH' | translate}}">
              </mat-form-field>
              <table mat-table  matSort #sortProduction matSortActive="name" matSortDirection="asc"
                     matSortDisableClear [dataSource]="productionServicesDataSource" class="w-100">
                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef class="w-20" mat-sort-header="name">{{ 'FACILITIES.NAME' | translate }}</th>
                  <td mat-cell *matCellDef="let providedService">{{ providedService.name | itemLocale }}</td>
                </ng-container>
                <ng-container matColumnDef="description">
                  <th mat-header-cell *matHeaderCellDef class="w-25" mat-sort-header="description">{{ 'FACILITIES.DESCRIPTION' | translate }}</th>
                  <td mat-cell *matCellDef="let providedService">{{ providedService.description | itemLocale }}</td>
                </ng-container>
                <ng-container matColumnDef="environment">
                  <th mat-header-cell *matHeaderCellDef class="w-10" mat-sort-header="environment">{{ 'FACILITIES.ENVIRONMENT' | translate }}</th>
                  <td mat-cell *matCellDef="let providedService">{{ providedService.environment | facilityEnvironment }}</td>
                </ng-container>
                <ng-container matColumnDef="protocol">
                  <th mat-header-cell *matHeaderCellDef class="w-10" mat-sort-header="protocol">{{ 'FACILITIES.PROTOCOL' | translate }}</th>
                  <td mat-cell *matCellDef="let providedService">{{ providedService.protocol }}</td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover-dark clickable"></tr>
              </table>
              <mat-paginator #paginatorProduction [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
            </mat-expansion-panel>
          </div>

          <!-- STAGE ENV -->
          <div *ngIf="hasStagingEnabled() && hasDisplayableStagingServices()" class="services-table-wrapper mb-5">
            <mat-expansion-panel class="mb-4">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h5>{{'SERVICES.STAGING_SERVICES_LIST' | translate}}</h5>
                </mat-panel-title>
              </mat-expansion-panel-header>
              <mat-form-field class="w-100">
                <mat-icon matPrefix class="mr-1">search</mat-icon>
                <input matInput type="text" (keyup)="doFilterStaging($event.target.value)" placeholder="{{ 'SEARCH' | translate}}">
              </mat-form-field>
              <table mat-table matSort #sortStaging matSortActive="name" matSortDirection="asc"
                     matSortDisableClear [dataSource]="stagingServicesDataSource" class="w-100">
                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef class="w-20" mat-sort-header="name">{{ 'FACILITIES.NAME' | translate }}</th>
                  <td mat-cell *matCellDef="let providedService">{{ providedService.name | itemLocale }}</td>
                </ng-container>
                <ng-container matColumnDef="description">
                  <th mat-header-cell *matHeaderCellDef class="w-25" mat-sort-header="description">{{ 'FACILITIES.DESCRIPTION' | translate }}</th>
                  <td mat-cell *matCellDef="let providedService">{{ providedService.description | itemLocale }}</td>
                </ng-container>
                <ng-container matColumnDef="environment">
                  <th mat-header-cell *matHeaderCellDef class="w-10" mat-sort-header="environment">{{ 'FACILITIES.ENVIRONMENT' | translate }}</th>
                  <td mat-cell *matCellDef="let providedService">{{ providedService.environment | facilityEnvironment }}</td>
                </ng-container>
                <ng-container matColumnDef="protocol">
                  <th mat-header-cell *matHeaderCellDef class="w-10" mat-sort-header="protocol">{{ 'FACILITIES.PROTOCOL' | translate }}</th>
                  <td mat-cell *matCellDef="let providedService">{{ providedService.protocol }}</td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover-dark clickable"></tr>
              </table>
              <mat-paginator #paginatorStaging [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
            </mat-expansion-panel>
          </div>

          <!-- TEST ENV -->
          <div *ngIf="hasTestingEnabled() && hasDisplayableTestingServices()" class="services-table-wrapper mb-5">
            <mat-expansion-panel class="mb-4">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h5>{{'SERVICES.TESTING_SERVICES_LIST' | translate}}</h5>
                </mat-panel-title>
              </mat-expansion-panel-header>
              <mat-form-field class="w-100">
                <mat-icon matPrefix class="mr-1">search</mat-icon>
                <input matInput type="text" (keyup)="doFilterTesting($event.target.value)" placeholder="{{ 'SEARCH' | translate }}">
              </mat-form-field>
              <table *ngIf="!isLoadingTable" mat-table  matSort #sortTesting="matSort" matSortActive="name" matSortDirection="asc"
                     matSortDisableClear [dataSource]="testingServicesDataSource" class="w-100">
                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef class="w-20" mat-sort-header="name">{{ 'FACILITIES.NAME' | translate }}</th>
                  <td mat-cell *matCellDef="let providedService">{{ providedService.name | itemLocale }}</td>
                </ng-container>
                <ng-container matColumnDef="description">
                  <th mat-header-cell *matHeaderCellDef class="w-25" mat-sort-header="description">{{ 'FACILITIES.DESCRIPTION' | translate }}</th>
                  <td mat-cell *matCellDef="let providedService">{{ providedService.description | itemLocale }}</td>
                </ng-container>
                <ng-container matColumnDef="environment">
                  <th mat-header-cell *matHeaderCellDef class="w-10" mat-sort-header="environment">{{ 'FACILITIES.ENVIRONMENT' | translate }}</th>
                  <td mat-cell *matCellDef="let providedService">{{ providedService.environment | facilityEnvironment }}</td>
                </ng-container>
                <ng-container matColumnDef="protocol">
                  <th mat-header-cell *matHeaderCellDef class="w-10" mat-sort-header="protocol">{{ 'FACILITIES.PROTOCOL' | translate }}</th>
                  <td mat-cell *matCellDef="let providedService">{{ providedService.protocol }}</td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover-dark clickable"></tr>
              </table>
              <mat-paginator #paginatorTesting [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
            </mat-expansion-panel>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>
