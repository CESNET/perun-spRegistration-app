
<div class="container-fluid pt-5">
  <div class="card shadow-sm">
    <div class="card-body p-3 p-lg-5">
      <h4 class="card-title">
        {{ 'MENU.STATISTICS' | translate }}
      </h4>

      <div class="row overview-row">
        <div class="col-md-6">
          <div *ngIf="isLoadingTable"
               style="display: flex; justify-content: center; align-items: center; background: white;">
            <mat-progress-spinner color="primary" mode="indeterminate"></mat-progress-spinner>
          </div>
          <table *ngIf="!isLoadingTable" class="table table-stats overview-table">
            <tr>
              <th></th>
              <th>{{ 'SERVICES.PRODUCTION_SERVICES' | translate }}</th>
              <th>{{ 'SERVICES.STAGING_SERVICES' | translate }}</th>
              <th>{{ 'SERVICES.TESTING_SERVICES' | translate }}</th>
            </tr>
            <tr>
              <th>{{ 'SERVICES.ALL' | translate }}</th>
              <th>{{ servicesOverview.samlServicesCount['PRODUCTION'] + servicesOverview.oidcServicesCount['PRODUCTION'] }}</th>
              <th>{{ servicesOverview.samlServicesCount['STAGING'] + servicesOverview.oidcServicesCount['STAGING'] }}</th>
              <th>{{ servicesOverview.samlServicesCount['TESTING'] + servicesOverview.oidcServicesCount['TESTING'] }}</th>
            </tr>
            <tr>
              <th>{{ 'SERVICES.SAML' | translate }}</th>
              <th>{{ servicesOverview.samlServicesCount['PRODUCTION'] }}</th>
              <th>{{ servicesOverview.samlServicesCount['STAGING'] }}</th>
              <th>{{ servicesOverview.samlServicesCount['TESTING'] }}</th>
            </tr>
            <tr>
              <th>{{ 'SERVICES.OIDC' | translate }}</th>
              <th>{{ servicesOverview.oidcServicesCount['PRODUCTION'] }}</th>
              <th>{{ servicesOverview.oidcServicesCount['STAGING'] }}</th>
              <th>{{ servicesOverview.oidcServicesCount['TESTING'] }}</th>
            </tr>
          </table>
        </div>
        <div class="col-md-5 offset-1">
          <div *ngIf="isLoadingTable"
               style="display: flex; justify-content: center; align-items: center; background: white;">
            <mat-progress-spinner color="primary" mode="indeterminate"></mat-progress-spinner>
          </div>

          <ngx-charts-bar-vertical
            [view]=""
            [results]="overviewTableData"
            [customColors]="colorScheme"
            [xAxis]="true"
            [yAxis]="true"
            [yAxisTickFormatting]="axisFormat"
            [gradient]="true">
          </ngx-charts-bar-vertical>

        </div>
      </div>

      <div *ngIf="!(hasDisplayableStagingServices() || hasDisplayableTestingServices())">
        <h4>
          {{ 'SERVICES.PRODUCTION_SERVICES_LIST' | translate }}
        </h4>
        <mat-form-field class="w-100">
          <mat-icon matPrefix class="mr-1">search</mat-icon>
          <input matInput type="text" (keyup)="doFilterProduction($event.target.value)" placeholder="{{ 'SEARCH' | translate }}">
        </mat-form-field>
        <div>
          <div *ngIf="isLoadingTable"
               style="display: flex; justify-content: center; align-items: center; background: white;">
            <mat-progress-spinner color="primary" mode="indeterminate"></mat-progress-spinner>
          </div>
          <table *ngIf="!isLoadingTable" mat-table  matSort #sortProduction matSortActive="name" matSortDirection="asc"
                 matSortDisableClear [dataSource]="productionServicesDataSource" class="w-100">
            <ng-container *ngIf="displayedColumns.includes('name')" matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef class="w-20" mat-sort-header>{{ 'FACILITIES.NAME' | translate }}</th>
              <td mat-cell *matCellDef="let providedService">{{ providedService.name | itemLocale }}</td>
            </ng-container>
            <ng-container *ngIf="displayedColumns.includes('description')" matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef class="w-25" mat-sort-header>{{ 'FACILITIES.DESCRIPTION' | translate }}</th>
              <td mat-cell *matCellDef="let providedService">{{ providedService.description | itemLocale }}</td>
            </ng-container>
            <ng-container *ngIf="displayedColumns.includes('environment')" matColumnDef="environment">
              <th mat-header-cell *matHeaderCellDef class="w-10" mat-sort-header>{{ 'FACILITIES.ENVIRONMENT' | translate }}</th>
              <td mat-cell *matCellDef="let providedService">{{ providedService.environment | facilityEnvironment }}</td>
            </ng-container>
            <ng-container *ngIf="displayedColumns.includes('protocol')" matColumnDef="protocol">
              <th mat-header-cell *matHeaderCellDef class="w-10" mat-sort-header>{{ 'FACILITIES.PROTOCOL' | translate }}</th>
              <td mat-cell *matCellDef="let providedService">{{ providedService.protocol }}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover-dark clickable"></tr>
          </table>
          <mat-paginator #paginatorProduction [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
        </div>
      </div>

      <div *ngIf="hasDisplayableStagingServices() || hasDisplayableTestingServices()">
        <mat-expansion-panel class="mb-2" [expanded]="true">
          <mat-expansion-panel-header>
            <mat-panel-title>
              {{ 'SERVICES.PRODUCTION_SERVICES_LIST' | translate }}
            </mat-panel-title>
          </mat-expansion-panel-header>
          <mat-form-field class="w-100">
            <mat-icon matPrefix class="mr-1">search</mat-icon>
            <input matInput type="text" (keyup)="doFilterProduction($event.target.value)" placeholder="{{ 'SEARCH' | translate}}">
          </mat-form-field>
          <div>
            <div *ngIf="isLoadingTable"
                 style="display: flex; justify-content: center; align-items: center; background: white;">
              <mat-progress-spinner color="primary" mode="indeterminate"></mat-progress-spinner>
            </div>
            <table *ngIf="!isLoadingTable" mat-table  matSort #sortProduction matSortActive="name" matSortDirection="asc"
                   matSortDisableClear [dataSource]="productionServicesDataSource" class="w-100">
              <ng-container *ngIf="displayedColumns.includes('name')" matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef class="w-20" mat-sort-header>{{ 'FACILITIES.NAME' | translate }}</th>
                <td mat-cell *matCellDef="let providedService">{{ providedService.name | itemLocale }}</td>
              </ng-container>
              <ng-container *ngIf="displayedColumns.includes('description')" matColumnDef="description">
                <th mat-header-cell *matHeaderCellDef class="w-25" mat-sort-header>{{ 'FACILITIES.DESCRIPTION' | translate }}</th>
                <td mat-cell *matCellDef="let providedService">{{ providedService.description | itemLocale }}</td>
              </ng-container>
              <ng-container *ngIf="displayedColumns.includes('environment')" matColumnDef="environment">
                <th mat-header-cell *matHeaderCellDef class="w-10" mat-sort-header>{{ 'FACILITIES.ENVIRONMENT' | translate }}</th>
                <td mat-cell *matCellDef="let providedService">{{ providedService.environment | facilityEnvironment }}</td>
              </ng-container>
              <ng-container *ngIf="displayedColumns.includes('protocol')" matColumnDef="protocol">
                <th mat-header-cell *matHeaderCellDef class="w-10" mat-sort-header>{{ 'FACILITIES.PROTOCOL' | translate }}</th>
                <td mat-cell *matCellDef="let providedService">{{ providedService.protocol }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover-dark clickable"></tr>
            </table>
            <mat-paginator #paginatorProduction [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
          </div>
        </mat-expansion-panel>
      </div>

      <div *ngIf="hasDisplayableStagingServices()" class="services-table-wrapper">
        <mat-expansion-panel class="mb-2" [expanded]="true">
          <mat-expansion-panel-header>
            <mat-panel-title>
              {{'SERVICES.STAGING_SERVICES_LIST' | translate}}
            </mat-panel-title>
          </mat-expansion-panel-header>
          <mat-form-field class="w-100">
            <mat-icon matPrefix class="mr-1">search</mat-icon>
            <input matInput type="text" (keyup)="doFilterStaging($event.target.value)" placeholder="{{ 'SEARCH' | translate}}">
          </mat-form-field>
          <div>
            <div *ngIf="isLoadingTable"
                 style="display: flex; justify-content: center; align-items: center; background: white;">
              <mat-progress-spinner color="primary" mode="indeterminate"></mat-progress-spinner>
            </div>
            <table *ngIf="!isLoadingTable" mat-table  matSort #sortStaging matSortActive="name" matSortDirection="asc"
                   matSortDisableClear [dataSource]="stagingServicesDataSource" class="w-100">
              <ng-container *ngIf="displayedColumns.includes('name')" matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef class="w-20" mat-sort-header>{{ 'FACILITIES.NAME' | translate }}</th>
                <td mat-cell *matCellDef="let providedService">{{ providedService.name | itemLocale }}</td>
              </ng-container>
              <ng-container *ngIf="displayedColumns.includes('description')" matColumnDef="description">
                <th mat-header-cell *matHeaderCellDef class="w-25" mat-sort-header>{{ 'FACILITIES.DESCRIPTION' | translate }}</th>
                <td mat-cell *matCellDef="let providedService">{{ providedService.description | itemLocale }}</td>
              </ng-container>
              <ng-container *ngIf="displayedColumns.includes('environment')" matColumnDef="environment">
                <th mat-header-cell *matHeaderCellDef class="w-10" mat-sort-header>{{ 'FACILITIES.ENVIRONMENT' | translate }}</th>
                <td mat-cell *matCellDef="let providedService">{{ providedService.environment | facilityEnvironment }}</td>
              </ng-container>
              <ng-container *ngIf="displayedColumns.includes('protocol')" matColumnDef="protocol">
                <th mat-header-cell *matHeaderCellDef class="w-10" mat-sort-header>{{ 'FACILITIES.PROTOCOL' | translate }}</th>
                <td mat-cell *matCellDef="let providedService">{{ providedService.protocol }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover-dark clickable"></tr>
            </table>
            <mat-paginator #paginatorStaging [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
          </div>
        </mat-expansion-panel>
      </div>

      <div *ngIf="hasDisplayableTestingServices()" class="services-table-wrapper">
        <mat-expansion-panel class="mb-2" [expanded]="true">
          <mat-expansion-panel-header>
            <mat-panel-title>
              {{'SERVICES.TESTING_SERVICES_LIST' | translate}}
            </mat-panel-title>
          </mat-expansion-panel-header>
          <mat-form-field class="w-100">
            <mat-icon matPrefix class="mr-1">search</mat-icon>
            <input matInput type="text" (keyup)="doFilterTesting($event.target.value)" placeholder="{{ 'SEARCH' | translate }}">
          </mat-form-field>
          <div>
            <div *ngIf="isLoadingTable"
                 style="display: flex; justify-content: center; align-items: center; background: white;">
              <mat-progress-spinner color="primary" mode="indeterminate"></mat-progress-spinner>
            </div>
            <table *ngIf="!isLoadingTable" mat-table  matSort #sortTesting="matSort" matSortActive="name" matSortDirection="asc"
                   matSortDisableClear [dataSource]="testingServicesDataSource" class="w-100">
              <ng-container *ngIf="displayedColumns.includes('name')" matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef class="w-20" mat-sort-header>{{ 'FACILITIES.NAME' | translate }}</th>
                <td mat-cell *matCellDef="let providedService">{{ providedService.name | itemLocale }}</td>
              </ng-container>
              <ng-container *ngIf="displayedColumns.includes('description')" matColumnDef="description">
                <th mat-header-cell *matHeaderCellDef class="w-25" mat-sort-header>{{ 'FACILITIES.DESCRIPTION' | translate }}</th>
                <td mat-cell *matCellDef="let providedService">{{ providedService.description | itemLocale }}</td>
              </ng-container>
              <ng-container *ngIf="displayedColumns.includes('environment')" matColumnDef="environment">
                <th mat-header-cell *matHeaderCellDef class="w-10" mat-sort-header>{{ 'FACILITIES.ENVIRONMENT' | translate }}</th>
                <td mat-cell *matCellDef="let providedService">{{ providedService.environment | facilityEnvironment }}</td>
              </ng-container>
              <ng-container *ngIf="displayedColumns.includes('protocol')" matColumnDef="protocol">
                <th mat-header-cell *matHeaderCellDef class="w-10" mat-sort-header>{{ 'FACILITIES.PROTOCOL' | translate }}</th>
                <td mat-cell *matCellDef="let providedService">{{ providedService.protocol }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover-dark clickable"></tr>
            </table>
            <mat-paginator #paginatorTesting [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
          </div>
        </mat-expansion-panel>
      </div>

    </div>
  </div>
</div>
